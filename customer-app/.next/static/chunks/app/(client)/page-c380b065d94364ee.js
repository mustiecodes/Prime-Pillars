(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[993],{1535:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>x});var n=a(5155),r=a(2115),l=a(5695),s=a(4003),i=a(3743);function o(e){let{label:t,name:a,error:r,children:l,disabled:s,...i}=e;return(0,n.jsxs)("div",{className:"space-y-1",children:[(0,n.jsx)("label",{htmlFor:a,className:"block font-semibold text-gray-800 text-sm",children:t}),(0,n.jsx)("select",{id:a,name:a,"aria-invalid":!!r,disabled:s,className:"w-full px-3 py-2 rounded-md border text-sm focus:outline-none ".concat(r?"border-red-500 focus:ring-red-300":"border-gray-300 focus:border-[#0057A0]"," ").concat(s?"bg-gray-100 cursor-not-allowed text-gray-500":"bg-white"),...i,children:l}),r&&(0,n.jsx)("p",{className:"text-xs text-red-600 mt-1",children:r})]})}let d=e=>e?"application/pdf"!==e.type?"Only PDF files are allowed.":e.size>2097152?"File too large. Max size is ".concat(2,"MB."):null:null;function c(e){let{requiredDocs:t,requiredUploads:a,onRequiredChange:l,optionalDocs:s,onOptionalChange:i,onAddOptional:o,onRemoveOptional:c}=e,[u,p]=(0,r.useState)({required:{},optional:{}}),m=(e,t)=>{let a=d(t);p(t=>({...t,required:{...t.required,[e]:a||""}})),a||l(e,t)},h=(e,t)=>{let a=d(t);p(t=>({...t,optional:{...t.optional,[e]:a||""}})),a||i(e,"file",t)};return(0,n.jsxs)("div",{className:"space-y-8",children:[(0,n.jsxs)("section",{children:[(0,n.jsx)("h2",{className:"text-xl font-semibold text-[#0057A0] border-b border-[#0057A0] pb-2 mb-4",children:"Mandatory Uploads"}),(0,n.jsx)("div",{className:"space-y-6",children:t.map(e=>{var t;return(0,n.jsxs)("div",{className:"space-y-1",children:[(0,n.jsx)("label",{className:"block font-semibold text-sm text-gray-800",children:e}),(0,n.jsx)("input",{type:"file",required:!0,accept:"application/pdf",onChange:t=>{var a;return m(e,(null==(a=t.target.files)?void 0:a[0])||null)},className:"w-full px-3 py-2 rounded border border-gray-300 text-sm file:rounded file:border-0 file:bg-gray-100 file:px-3 file:py-2 file:text-gray-700"}),a[e]&&!u.required[e]&&(0,n.jsxs)("p",{className:"text-xs text-green-600 mt-1",children:["✅ ",null==(t=a[e])?void 0:t.name]}),u.required[e]&&(0,n.jsxs)("p",{className:"text-xs text-red-600 mt-1",children:["❌ ",u.required[e]]})]},e)})})]}),(0,n.jsxs)("section",{children:[(0,n.jsx)("h2",{className:"text-xl font-semibold text-[#0057A0] border-b border-[#0057A0] pb-2 mb-4",children:"Optional Upload"}),(0,n.jsxs)("div",{className:"space-y-4",children:[s.map((e,t)=>(0,n.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 items-center",children:[(0,n.jsx)("input",{type:"text",placeholder:"Document Title",value:e.title,className:"w-full px-3 py-2 rounded border border-gray-300 text-sm",onChange:e=>i(t,"title",e.target.value)}),(0,n.jsx)("input",{type:"file",accept:"application/pdf",onChange:e=>{var a;return h(t,(null==(a=e.target.files)?void 0:a[0])||null)},className:"w-full px-3 py-2 rounded border border-gray-300 text-sm file:rounded file:border-0 file:bg-gray-100 file:px-3 file:py-2 file:text-gray-700"}),e.file&&!u.optional[t]&&(0,n.jsxs)("p",{className:"text-xs text-green-600 col-span-2",children:["✅ ",e.file.name]}),u.optional[t]&&(0,n.jsxs)("p",{className:"text-xs text-red-600 col-span-2",children:["❌ ",u.optional[t]]}),(0,n.jsx)("button",{type:"button",onClick:()=>c(t),className:"text-red-600 text-sm hover:underline col-span-2",children:"Remove"})]},t)),(0,n.jsx)("button",{type:"button",onClick:o,className:"text-[#0057A0] text-sm hover:underline",children:"+ Add Another Optional Document"})]})]})]})}var u=a(1886),p=a(9913);let m=["Account Opening Form","NIN Slip","Undertaken Form","Consent Form","Indemnity Form","Application Letter","Passport"];function h(e){let{initialData:t}=e,a=(0,l.useRouter)(),[s,d]=(0,r.useState)({penNumber:"",firstName:"",surname:"",otherNames:"",email:"",pfa:"",rsaBalance:"",bvn:"",nin:"",dob:"",phone1:"",phone2:"",altEmail:""}),[h,b]=(0,r.useState)({}),[x,f]=(0,r.useState)({}),[g,v]=(0,r.useState)([{title:"",file:null}]),[j,y]=(0,r.useState)([]),[N,A]=(0,r.useState)(""),[w,C]=(0,r.useState)(!1);(0,r.useEffect)(()=>{t&&d({penNumber:t.pen_number||"",firstName:t.first_name||"",surname:t.surname||"",otherNames:t.other_names||"",email:t.email||"",pfa:t.pfa||"",rsaBalance:t.rsa_balance||"",bvn:t.bvn||"",nin:t.nin||"",dob:t.dob||"",phone1:t.phone_number||"",phone2:t.alt_phone||"",altEmail:t.alt_email||""})},[t]),(0,r.useEffect)(()=>{(async()=>{try{let e=await fetch("http://localhost:5000/api/admin/pfa"),t=await e.json();y(t.map(e=>e.name))}catch(e){console.error("Failed to fetch PFAs")}})()},[]);let E=e=>{let{name:t,value:a}=e.target;if(!["bvn","nin"].includes(t)||/^\d*$/.test(a)&&!(a.length>12)){if(!["phone1","phone2"].includes(t)||/^\d*$/.test(a)&&!(a.length>11)){if("rsaBalance"===t){let e=a.replace(/,/g,"").replace(/\D/g,"").replace(/\B(?=(\d{3})+(?!\d))/g,",");d(a=>({...a,[t]:e})),b(e=>({...e,[t]:""}));return}d(e=>({...e,[t]:a})),b(e=>({...e,[t]:""}))}}},k=async e=>{e.preventDefault(),C(!0),A(""),b({});let t=(0,p.Q2)({rsaBalance:s.rsaBalance,bvn:s.bvn,nin:s.nin,dob:s.dob,phone1:s.phone1});if(Object.keys(t).length>0){b(t),C(!1);return}try{await (0,u.Rg)(s,x,g,x.Passport),a.push("/client/".concat(s.penNumber))}catch(e){A("❌ Could not submit application.")}finally{C(!1)}};return(0,n.jsxs)("form",{className:"space-y-10",onSubmit:k,children:[(0,n.jsxs)("section",{children:[(0,n.jsx)("h2",{className:"text-xl font-semibold text-[#0057A0] border-b pb-2",children:"Biodata"}),(0,n.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,n.jsx)(i.A,{label:"First Name",name:"firstName",value:s.firstName,disabled:!0}),(0,n.jsx)(i.A,{label:"Surname",name:"surname",value:s.surname,disabled:!0}),(0,n.jsx)(i.A,{label:"Other Names",name:"otherNames",value:s.otherNames,disabled:!0})]})]}),(0,n.jsxs)("section",{children:[(0,n.jsx)("h2",{className:"text-xl font-semibold text-[#0057A0] border-b pb-2",children:"RSA and Personal Info"}),(0,n.jsxs)("div",{className:"space-y-4",children:[(0,n.jsxs)(o,{label:"PFA",name:"pfa",value:s.pfa,onChange:E,children:[(0,n.jsx)("option",{value:"",children:"Select your PFA"}),j.map(e=>(0,n.jsx)("option",{value:e,children:e},e))]}),(0,n.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,n.jsx)(i.A,{label:"RSA Balance",name:"rsaBalance",value:s.rsaBalance,onChange:E}),(0,n.jsx)(i.A,{label:"BVN",name:"bvn",value:s.bvn,onChange:E}),(0,n.jsx)(i.A,{label:"NIN",name:"nin",value:s.nin,onChange:E}),(0,n.jsx)(i.A,{label:"Date of Birth",name:"dob",type:"date",value:s.dob,onChange:E}),(0,n.jsx)(i.A,{label:"Phone Number",name:"phone1",value:s.phone1,onChange:E}),(0,n.jsx)(i.A,{label:"Alt Phone",name:"phone2",value:s.phone2,onChange:E}),(0,n.jsx)(i.A,{label:"Email",name:"email",value:s.email,disabled:!0}),(0,n.jsx)(i.A,{label:"Alt Email",name:"altEmail",value:s.altEmail,onChange:E})]})]})]}),(0,n.jsx)("section",{children:(0,n.jsx)(c,{requiredDocs:m,requiredUploads:x,onRequiredChange:(e,t)=>{f(a=>({...a,[e]:t}))},optionalDocs:g,onOptionalChange:(e,t,a)=>{v(n=>{let r=[...n];return r[e][t]=a,r})},onAddOptional:()=>{v(e=>[...e,{title:"",file:null}])},onRemoveOptional:e=>{v(t=>t.filter((t,a)=>a!==e))}})}),(0,n.jsx)("button",{type:"submit",disabled:w,className:"w-full bg-[#0057A0] hover:bg-[#003f7a] text-white font-semibold py-3 rounded-md",children:w?"Submitting...":"Submit"}),N&&(0,n.jsx)("p",{className:"text-sm text-gray-600 text-center",children:N})]})}var b=a(6586);function x(){let e=(0,l.useRouter)(),{user:t,loading:a}=(0,b.A)(),[i,o]=(0,r.useState)(!1);return((0,r.useEffect)(()=>{if(!a){if(!t)return void e.push("/login");if(t&&"client"!==t.role)return void e.push("/");o(!0)}},[a,t,e]),a||!i)?(0,n.jsx)(s.A,{children:(0,n.jsx)("p",{className:"text-center text-gray-600",children:"Loading..."})}):(0,n.jsx)(s.A,{title:"Housing Application",children:(0,n.jsx)(h,{initialData:t})})}},1886:(e,t,a)=>{"use strict";a.d(t,{DY:()=>d,Lx:()=>o,Rg:()=>i,Vg:()=>l});let n=e=>"".concat("http://localhost:5000").concat(e),r=async e=>{if(!e.ok)throw Error((await e.json().catch(()=>({}))).error||"An unexpected error occurred");return e.json()};async function l(e){return r(await fetch(n(e),{method:"GET",credentials:"include"}))}async function s(e,t){return r(await fetch(n(e),{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)}))}async function i(e,t,a,l){let s=new FormData;return s.append("pen_number",e.penNumber),s.append("pfa",e.pfa),s.append("rsa_balance",e.rsaBalance),s.append("bvn",e.bvn),s.append("nin",e.nin),s.append("dob",e.dob),s.append("phone_number",e.phone1),s.append("alt_phone",e.phone2),s.append("alt_email",e.altEmail),Object.entries(t).forEach(e=>{let[t,a]=e;a&&s.append("documents",a,t)}),a.forEach(e=>{let{title:t,file:a}=e;a&&t&&s.append("documents",a,"optional:".concat(t))}),l&&s.append("passport",l),r(await fetch(n("/api/application/submit"),{method:"POST",credentials:"include",body:s}))}async function o(e){return s("/api/auth/login",e)}async function d(e){return s("/api/auth/register",e)}},3743:(e,t,a)=>{"use strict";a.d(t,{A:()=>i});var n=a(5155),r=a(2115);let l=r.forwardRef(function(e,t){let{title:a,titleId:n,...l}=e;return r.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:t,"aria-labelledby":n},l),a?r.createElement("title",{id:n},a):null,r.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M3.98 8.223A10.477 10.477 0 0 0 1.934 12C3.226 16.338 7.244 19.5 12 19.5c.993 0 1.953-.138 2.863-.395M6.228 6.228A10.451 10.451 0 0 1 12 4.5c4.756 0 8.773 3.162 10.065 7.498a10.522 10.522 0 0 1-4.293 5.774M6.228 6.228 3 3m3.228 3.228 3.65 3.65m7.894 7.894L21 21m-3.228-3.228-3.65-3.65m0 0a3 3 0 1 0-4.243-4.243m4.242 4.242L9.88 9.88"}))}),s=r.forwardRef(function(e,t){let{title:a,titleId:n,...l}=e;return r.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:t,"aria-labelledby":n},l),a?r.createElement("title",{id:n},a):null,r.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M2.036 12.322a1.012 1.012 0 0 1 0-.639C3.423 7.51 7.36 4.5 12 4.5c4.638 0 8.573 3.007 9.963 7.178.07.207.07.431 0 .639C20.577 16.49 16.64 19.5 12 19.5c-4.638 0-8.573-3.007-9.963-7.178Z"}),r.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 12a3 3 0 1 1-6 0 3 3 0 0 1 6 0Z"}))});function i(e){let{label:t,name:a,type:i="text",value:o,onChange:d,error:c,disabled:u=!1,required:p=!1,...m}=e,[h,b]=(0,r.useState)(!1),x="password"===i,f="input-".concat(a);return(0,n.jsxs)("div",{className:"space-y-1 relative",children:[(0,n.jsxs)("label",{htmlFor:f,className:"block font-semibold text-gray-800 text-sm",children:[t," ",p&&(0,n.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,n.jsxs)("div",{className:"relative",children:[(0,n.jsx)("input",{id:f,name:a,type:x&&h?"text":i,value:o,disabled:u,onChange:d,"aria-invalid":!!c,className:"w-full px-3 py-2 pr-10 rounded-md border text-sm focus:outline-none ".concat(c?"border-red-500 focus:ring-red-300":"border-gray-300 focus:border-[#0057A0]"," ").concat(u?"bg-gray-100 cursor-not-allowed":"bg-white"),...m}),x&&(0,n.jsx)("button",{type:"button",onClick:()=>b(e=>!e),className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-500 hover:text-gray-800",tabIndex:-1,children:h?(0,n.jsx)(l,{className:"h-5 w-5"}):(0,n.jsx)(s,{className:"h-5 w-5"})})]}),c&&(0,n.jsx)("p",{className:"text-xs text-red-600 mt-1",children:c})]})}},4003:(e,t,a)=>{"use strict";a.d(t,{A:()=>r});var n=a(5155);function r(e){let{title:t,children:a,className:r="",contentClassName:l=""}=e;return(0,n.jsx)("div",{className:"max-w-4xl mx-auto mt-10 ",children:(0,n.jsx)("div",{className:"space-y-6 ".concat(l),children:a})})}a(2115)},4297:(e,t,a)=>{Promise.resolve().then(a.bind(a,1535))},6586:(e,t,a)=>{"use strict";a.d(t,{AuthProvider:()=>i,A:()=>o});var n=a(5155),r=a(2115);let l=a(3464).A.create({baseURL:"http://localhost:5000/api",withCredentials:!0}),s=(0,r.createContext)(void 0),i=e=>{let{children:t}=e,[a,i]=(0,r.useState)(null),[o,d]=(0,r.useState)(!0),c=(0,r.useCallback)(async()=>{try{let e=await l.get("/auth/me");i(e.data)}catch(e){i(null)}finally{d(!1)}},[]);return(0,r.useEffect)(()=>{c()},[c]),(0,n.jsx)(s.Provider,{value:{user:a,loading:o,refreshUser:c},children:t})},o=()=>{let e=(0,r.useContext)(s);if(!e)throw Error("useAuth must be used within an AuthProvider");return e}},9913:(e,t,a)=>{"use strict";function n(e){let t={};return e.pen_number||(t.pen_number="PEN number is required"),e.password||(t.password="Password is required"),t}function r(e){let t={};return e.rsaBalance||(t.rsaBalance="RSA balance is required"),e.bvn?12!==e.bvn.length&&(t.bvn="BVN must be exactly 12 digits"):t.bvn="BVN is required",e.nin?12!==e.nin.length&&(t.nin="NIN must be exactly 12 digits"):t.nin="NIN is required",e.dob||(t.dob="Date of Birth is required"),e.phone1?11!==e.phone1.length&&(t.phone1="Phone number must be exactly 12 digits"):t.phone1="Phone number is required",t}a.d(t,{Q2:()=>r,ew:()=>n})}},e=>{var t=t=>e(e.s=t);e.O(0,[794,441,684,358],()=>t(4297)),_N_E=e.O()}]);